##Запуск PUT-запросов с помощью wrk2:

#### - частота запросов - 4000/сек
#### - продолжительность - 60 сек

~~~
evgen@evgen-ilin:~/mailru/2021-highload-dht$ wrk2 -c 1 -t 1 -d 60 -R 4000 -L 
-s wrk/put.lua http://localhost:8080
Running 1m test @ http://localhost:8080
1 threads and 1 connections
Thread calibration: mean lat.: 21.326ms, rate sampling interval: 10ms
Thread Stats   Avg      Stdev     Max   +/- Stdev
Latency    27.24ms  102.98ms 745.47ms   93.50%
Req/Sec     4.18k     2.42k   30.22k    90.69%
Latency Distribution (HdrHistogram - Recorded Latency)
50.000%    1.09ms
75.000%    1.62ms
90.000%    2.02ms
99.000%  559.61ms
99.900%  707.58ms
99.990%  741.89ms
99.999%  745.47ms
100.000%  745.98ms

Detailed Percentile spectrum:
Value   Percentile   TotalCount 1/(1-Percentile)

       0.024     0.000000            2         1.00
       0.306     0.100000        19840         1.11
       0.553     0.200000        39633         1.25
       0.784     0.300000        59452         1.43
       0.963     0.400000        79199         1.67
       1.091     0.500000        99116         2.00
       1.156     0.550000       108988         2.22
       1.250     0.600000       118837         2.50
       1.370     0.650000       128689         2.86
       1.494     0.700000       138658         3.33
       1.619     0.750000       148559         4.00
       1.681     0.775000       153487         4.44
       1.743     0.800000       158454         5.00
       1.806     0.825000       163396         5.71
       1.871     0.850000       168337         6.67
       1.937     0.875000       173250         8.00
       1.976     0.887500       175772         8.89
       2.021     0.900000       178224        10.00
       2.117     0.912500       180670        11.43
      51.839     0.925000       183135        13.33
     150.015     0.937500       185610        16.00
     200.063     0.943750       186848        17.78
     249.087     0.950000       188086        20.00
     296.703     0.956250       189322        22.86
     345.343     0.962500       190564        26.67
     394.239     0.968750       191798        32.00
     418.047     0.971875       192417        35.56
     442.367     0.975000       193036        40.00
     466.175     0.978125       193654        45.71
     491.519     0.981250       194275        53.33
     515.839     0.984375       194890        64.00
     528.383     0.985938       195212        71.11
     540.671     0.987500       195517        80.00
     552.447     0.989062       195824        91.43
     564.735     0.990625       196136       106.67
     577.023     0.992188       196446       128.00
     582.655     0.992969       196593       142.22
     588.799     0.993750       196750       160.00
     596.479     0.994531       196902       182.86
     604.671     0.995313       197062       213.33
     612.351     0.996094       197217       256.00
     615.935     0.996484       197288       284.44
     625.663     0.996875       197366       320.00
     641.535     0.997266       197444       365.71
     655.871     0.997656       197521       426.67
     670.719     0.998047       197598       512.00
     678.911     0.998242       197636       568.89
     687.103     0.998437       197676       640.00
     694.271     0.998633       197713       731.43
     701.439     0.998828       197753       853.33
     708.095     0.999023       197790      1024.00
     711.679     0.999121       197809      1137.78
     715.775     0.999219       197830      1280.00
     719.359     0.999316       197849      1462.86
     723.455     0.999414       197869      1706.67
     727.039     0.999512       197887      2048.00
     729.087     0.999561       197897      2275.56
     731.135     0.999609       197907      2560.00
     733.183     0.999658       197918      2925.71
     734.719     0.999707       197926      3413.33
     736.767     0.999756       197936      4096.00
     737.791     0.999780       197942      4551.11
     738.303     0.999805       197945      5120.00
     739.327     0.999829       197951      5851.43
     740.351     0.999854       197956      6826.67
     741.375     0.999878       197961      8192.00
     741.887     0.999890       197963      9102.22
     742.399     0.999902       197966     10240.00
     742.911     0.999915       197968     11702.86
     743.423     0.999927       197971     13653.33
     743.423     0.999939       197971     16384.00
     743.935     0.999945       197973     18204.44
     744.447     0.999951       197976     20480.00
     744.447     0.999957       197976     23405.71
     744.447     0.999963       197976     27306.67
     744.959     0.999969       197978     32768.00
     744.959     0.999973       197978     36408.89
     745.471     0.999976       197981     40960.00
     745.471     0.999979       197981     46811.43
     745.471     0.999982       197981     54613.33
     745.471     0.999985       197981     65536.00
     745.471     0.999986       197981     72817.78
     745.471     0.999988       197981     81920.00
     745.471     0.999989       197981     93622.86
     745.983     0.999991       197983    109226.67
     745.983     1.000000       197983          inf
#[Mean    =       27.235, StdDeviation   =      102.977]
#[Max     =      745.472, Total count    =       197983]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
238002 requests in 1.00m, 15.21MB read
Requests/sec:   3966.10
Transfer/sec:    259.50KB
~~~

Высокую задержку можно объяснить сравнительно большой строкой, 
передаваемую в качестве **value**, высокой частотойотправки запросов, 
а также довольно старым HDD-диском небольшого объема, используемым на ноутбуке.

###Результаты профилирования для операции PUT
#### - продолжительность - 10 сек

[CPU](cpu_put.html) \
Большая часть ресурсов (треть всего CPU) уходит на взаимодействие BasicService 
с файловой системой посредством реализации SSTable. 

[MEMORY](mem_put.html)

Это же и видно на профилировании выделения памяти - большая часть
ресурсов уходит именно на запись элементов, 
нежели на парсинг запросов.

##Запуск GET-запросов с помощью wrk2:

#### - частота запросов - 4000/сек
#### - продолжительность - 60 сек

~~~
evgen@evgen-ilin:~/mailru/2021-highload-dht$ wrk2 -c 1 -t 1 -d 60 -R 4000 -L 
-s wrk/get.lua http://localhost:8080
Running 1m test @ http://localhost:8080
  1 threads and 1 connections
  Thread calibration: mean lat.: 1.020ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.01ms  540.67us  10.58ms   64.64%
    Req/Sec     4.23k   335.50     5.90k    73.85%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.00ms
 75.000%    1.35ms
 90.000%    1.75ms
 99.000%    2.10ms
 99.900%    3.86ms
 99.990%    7.70ms
 99.999%   10.34ms
100.000%   10.59ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.039     0.000000            3         1.00
       0.300     0.100000        20076         1.11
       0.504     0.200000        40006         1.25
       0.692     0.300000        60058         1.43
       0.859     0.400000        80081         1.67
       0.999     0.500000       100004         2.00
       1.056     0.550000       110051         2.22
       1.113     0.600000       120068         2.50
       1.174     0.650000       130083         2.86
       1.252     0.700000       140043         3.33
       1.354     0.750000       150054         4.00
       1.415     0.775000       155000         4.44
       1.479     0.800000       160030         5.00
       1.543     0.825000       164988         5.71
       1.611     0.850000       170019         6.67
       1.683     0.875000       175043         8.00
       1.718     0.887500       177539         8.89
       1.754     0.900000       180012        10.00
       1.792     0.912500       182522        11.43
       1.830     0.925000       184984        13.33
       1.869     0.937500       187511        16.00
       1.890     0.943750       188745        17.78
       1.912     0.950000       190022        20.00
       1.935     0.956250       191265        22.86
       1.958     0.962500       192506        26.67
       1.983     0.968750       193762        32.00
       1.995     0.971875       194381        35.56
       2.009     0.975000       194992        40.00
       2.023     0.978125       195618        45.71
       2.038     0.981250       196238        53.33
       2.057     0.984375       196907        64.00
       2.065     0.985938       197179        71.11
       2.075     0.987500       197499        80.00
       2.089     0.989062       197824        91.43
       2.105     0.990625       198141       106.67
       2.123     0.992188       198434       128.00
       2.137     0.992969       198587       142.22
       2.153     0.993750       198733       160.00
       2.177     0.994531       198898       182.86
       2.207     0.995313       199048       213.33
       2.257     0.996094       199201       256.00
       2.293     0.996484       199284       284.44
       2.341     0.996875       199358       320.00
       2.439     0.997266       199437       365.71
       2.565     0.997656       199514       426.67
       2.737     0.998047       199592       512.00
       2.859     0.998242       199633       568.89
       3.025     0.998437       199670       640.00
       3.283     0.998633       199709       731.43
       3.611     0.998828       199748       853.33
       3.937     0.999023       199787      1024.00
       4.139     0.999121       199807      1137.78
       4.363     0.999219       199827      1280.00
       4.575     0.999316       199846      1462.86
       4.779     0.999414       199865      1706.67
       4.991     0.999512       199885      2048.00
       5.135     0.999561       199895      2275.56
       5.247     0.999609       199904      2560.00
       5.407     0.999658       199914      2925.71
       5.627     0.999707       199924      3413.33
       5.875     0.999756       199934      4096.00
       6.007     0.999780       199939      4551.11
       6.083     0.999805       199943      5120.00
       6.279     0.999829       199948      5851.43
       6.355     0.999854       199953      6826.67
       7.083     0.999878       199958      8192.00
       7.543     0.999890       199961      9102.22
       7.859     0.999902       199963     10240.00
       8.175     0.999915       199965     11702.86
       8.639     0.999927       199968     13653.33
       8.911     0.999939       199970     16384.00
       9.095     0.999945       199972     18204.44
       9.255     0.999951       199973     20480.00
       9.423     0.999957       199974     23405.71
       9.591     0.999963       199975     27306.67
       9.735     0.999969       199976     32768.00
       9.887     0.999973       199977     36408.89
      10.039     0.999976       199978     40960.00
      10.039     0.999979       199978     46811.43
      10.199     0.999982       199979     54613.33
      10.199     0.999985       199979     65536.00
      10.343     0.999986       199980     72817.78
      10.343     0.999988       199980     81920.00
      10.343     0.999989       199980     93622.86
      10.487     0.999991       199981    109226.67
      10.487     0.999992       199981    131072.00
      10.487     0.999993       199981    145635.56
      10.487     0.999994       199981    163840.00
      10.487     0.999995       199981    187245.71
      10.591     0.999995       199982    218453.33
      10.591     1.000000       199982          inf
#[Mean    =        1.008, StdDeviation   =        0.541]
#[Max     =       10.584, Total count    =       199982]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  239999 requests in 1.00m, 36.74MB read
  Non-2xx or 3xx responses: 4
Requests/sec:   3999.99
Transfer/sec:    627.09KB
~~~

В отличие от PUT-запросов, GET-запросы обрабатывались на порядок быстрее, 
в виду гораздо меньшего взаимодействия BasicService с файловой системой, что видно на профилировании

###Результаты профилирования операции GET
#### - продолжительность - 10 сек
[CPU](cpu_get.html) \
По сравнению с PUT-запросами практически отсутствует работа с файловой системой в части BasicService,
что объясняет такой прирост в скорости ответа.

[MEMORY](mem_get.html)

Более половины ресурсов тратится на метод ***range*** класса LsmDAO.
Также весьма большую часть отнимает проверка на наличие в базе следующего элемента.

